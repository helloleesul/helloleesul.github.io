{"componentChunkName":"component---src-templates-post-template-tsx","path":"/development/vm-deploy/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"tableOfContents":"<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\">들어가며</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#ssh-public-key\">SSH public key</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EF%B8%8F-%EA%B6%8C%ED%95%9C-%EC%98%A4%EB%A5%98-%EC%8B%9C\">⚠️ 권한 오류 시</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%B0%B0%ED%8F%AC-%EC%84%9C%EB%B2%84-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\">배포 서버 환경 설정</a></p>\n</li>\n<li>\n<p><a href=\"#express-%EC%95%B1-%EC%8B%A4%ED%96%89\">express 앱 실행</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B2%BD%EB%A1%9C-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">경로 설정하기</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EF%B8%8F-%ED%8C%8C%EC%9D%BC-%EC%88%98%EC%A0%95-%ED%99%95%EC%9D%B8-%EC%A0%90%EA%B2%80\">⚠️ 파일 수정 확인 점검</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>","fields":{"readingTime":{"text":"4 min read"}},"html":"<blockquote>\n<p>VM으로 PM2와 Nginx을 활용해 Express.js 백엔드와 React.js 프론트엔드 배포하기</p>\n</blockquote>\n<h3 id=\"들어가며\" style=\"position:relative;\">들어가며<a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"들어가며 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill=\"#a0aec0\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>지난 프로젝트를 백엔드(cloudtype), 프론트엔드(vercel) 각각 따로 배포하다가 CORS 에러로 인해 Azure VM을 생성해서 한 환경에 새로 배포하였다.</p>\n<p>배포하면서 터미널이 익숙해지기도 했고, 특히 vim같은 편집기가 무섭지 않아졌다. 사용했던 명령어들을 정리하고 싶어 기록해본다.</p>\n<hr>\n<h1 id=\"ssh-public-key\" style=\"position:relative;\">SSH public key<a href=\"#ssh-public-key\" aria-label=\"ssh public key permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill=\"#a0aec0\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>배포 서버 접속하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-i</span> ~/<span class=\"token punctuation\">{</span>SSH public key file<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span>username<span class=\"token punctuation\">}</span>@<span class=\"token punctuation\">{</span>ip<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"️-권한-오류-시\" style=\"position:relative;\">⚠️ 권한 오류 시<a href=\"#%EF%B8%8F-%EA%B6%8C%ED%95%9C-%EC%98%A4%EB%A5%98-%EC%8B%9C\" aria-label=\"️ 권한 오류 시 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill=\"#a0aec0\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>change mode 400으로 해당 파일을 소유자에게만 읽을 수 있게 권한을 축소시킨다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chmod</span> <span class=\"token number\">400</span> ~/<span class=\"token punctuation\">{</span>SSH public key file<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h1 id=\"배포-서버-환경-설정\" style=\"position:relative;\">배포 서버 환경 설정<a href=\"#%EB%B0%B0%ED%8F%AC-%EC%84%9C%EB%B2%84-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\" aria-label=\"배포 서버 환경 설정 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill=\"#a0aec0\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>리눅스 시스템 최신화하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update <span class=\"token parameter variable\">-y</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> upgrade <span class=\"token parameter variable\">-y</span></code></pre></div>\n<p>node 설치하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> <span class=\"token builtin class-name\">source</span> ~/.bashrc\nnvm <span class=\"token function\">install</span> <span class=\"token number\">16.14</span>.0\nnvm use <span class=\"token number\">16.14</span>.0\n\n<span class=\"token comment\"># 설치 확인</span>\n<span class=\"token function\">npm</span> <span class=\"token parameter variable\">-v</span>\n<span class=\"token function\">node</span> <span class=\"token parameter variable\">-v</span></code></pre></div>\n<hr>\n<h1 id=\"express-앱-실행\" style=\"position:relative;\">express 앱 실행<a href=\"#express-%EC%95%B1-%EC%8B%A4%ED%96%89\" aria-label=\"express 앱 실행 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill=\"#a0aec0\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>프로젝트 폴더 가져오기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone <span class=\"token punctuation\">{</span>repository url<span class=\"token punctuation\">}</span>\n<span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">{</span>project directory<span class=\"token punctuation\">}</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span></code></pre></div>\n<p>환경 변수 파일 생성하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">nano</span> .env\n<span class=\"token comment\"># 또는</span>\n<span class=\"token function\">vim</span> .env</code></pre></div>\n<table>\n<thead>\n<tr>\n<th>nano</th>\n<th>vim</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>- <code class=\"language-text\">Ctrl + O</code>: 저장<br>- <code class=\"language-text\">Ctrl + X</code>: 종료</td>\n<td>- <code class=\"language-text\">i</code>: 편집 모드<br>- <code class=\"language-text\">esc</code>: 명령\u001d모드<br>- <code class=\"language-text\">:w</code>: 저장<br>- <code class=\"language-text\">:q</code>: 종료<br>- <code class=\"language-text\">:wq</code>: 저장과 종료</td>\n</tr>\n</tbody>\n</table>\n<p>실행 확인하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> run start</code></pre></div>\n<p><strong>PM2 (Process Manager 2)</strong> 설치하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># PM2 - Node.js 애플리케이션의 프로세스 관리 및 실행 도구</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">--global</span> pm2\n\n<span class=\"token comment\"># 백엔드 폴더에서 실행</span>\npm2 <span class=\"token parameter variable\">--name</span> express start <span class=\"token function\">npm</span> -- run start\n\n<span class=\"token comment\"># 현재 실행 중인 프로세스 확인</span>\npm2 list\n\n<span class=\"token comment\"># 특정 프로세스 종료</span>\npm2 delete <span class=\"token punctuation\">{</span>number<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Nginx</strong> 설치하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Nginx - 웹 서버 소프트웨어</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> nginx</code></pre></div>\n<hr>\n<h1 id=\"경로-설정하기\" style=\"position:relative;\">경로 설정하기<a href=\"#%EA%B2%BD%EB%A1%9C-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"경로 설정하기 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill=\"#a0aec0\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 설정 파일 수정</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/nginx/sites-available/default</code></pre></div>\n<p>프론트엔드 경로 설정하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">location / <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\"># First attempt to serve request as file, then</span>\n  <span class=\"token comment\"># as directory, then fall back to displaying a 404.</span>\n\n  <span class=\"token comment\"># 프론트 빌드 파일 경로</span>\n  root /home/<span class=\"token punctuation\">{</span>username<span class=\"token punctuation\">}</span>/<span class=\"token punctuation\">{</span>FE directory<span class=\"token punctuation\">}</span>/build<span class=\"token punctuation\">;</span>\n  index index.html index.htm<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\"># 새로 고침 시 페이지 유지</span>\n  try_files <span class=\"token variable\">$uri</span> <span class=\"token variable\">$uri</span>/ /index.html<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>백엔드 API 경로 설정하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">location /api <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\"># proxy_pass 속성으로 백엔드 서버와 연결해주세요.</span>\n  proxy_pass http://127.0.0.1:<span class=\"token punctuation\">{</span>port 번호<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>파일 경로 설정하기</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">location /uploads <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin class-name\">alias</span> /<span class=\"token punctuation\">{</span>실제 경로<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\"># 자동 디렉토리 리스트 생성 기능, 보안 문제로 사용하지 않는 것이 안전</span>\n  autoindex on<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"️-파일-수정-확인-점검\" style=\"position:relative;\">⚠️ 파일 수정 확인 점검<a href=\"#%EF%B8%8F-%ED%8C%8C%EC%9D%BC-%EC%88%98%EC%A0%95-%ED%99%95%EC%9D%B8-%EC%A0%90%EA%B2%80\" aria-label=\"️ 파일 수정 확인 점검 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill=\"#a0aec0\" fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 문법 오류 없음을 테스트</span>\n<span class=\"token function\">sudo</span> nginx <span class=\"token parameter variable\">-t</span>\n\n<span class=\"token comment\"># nginx 재실행 (재실행해야, 수정된 설정파일이 반영됨)</span>\n<span class=\"token function\">sudo</span> systemctl reload nginx\n\n<span class=\"token comment\"># 만약 위 명령어가 안 되는 경우</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx restart\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx reload\n\n<span class=\"token comment\"># nginx 서비스 상태 확인</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx status</code></pre></div>","frontmatter":{"title":"가상머신(VM)으로 배포하는 방법","summary":"VM으로 PM2와 Nginx을 활용해 Express.js 백엔드와 React.js 프론트엔드 배포하기","date":"2024-03-28","categories":["개발"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#58c8e8","images":{"fallback":{"src":"/static/75a4ef063e6184ed5819527bf4104b5b/9ce37/vm-deploy.png","srcSet":"/static/75a4ef063e6184ed5819527bf4104b5b/e1116/vm-deploy.png 384w,\n/static/75a4ef063e6184ed5819527bf4104b5b/9b7d7/vm-deploy.png 768w,\n/static/75a4ef063e6184ed5819527bf4104b5b/9ce37/vm-deploy.png 1536w","sizes":"(min-width: 1536px) 1536px, 100vw"},"sources":[{"srcSet":"/static/75a4ef063e6184ed5819527bf4104b5b/5358b/vm-deploy.webp 384w,\n/static/75a4ef063e6184ed5819527bf4104b5b/81e8e/vm-deploy.webp 768w,\n/static/75a4ef063e6184ed5819527bf4104b5b/fe26e/vm-deploy.webp 1536w","type":"image/webp","sizes":"(min-width: 1536px) 1536px, 100vw"}]},"width":1536,"height":804}},"publicURL":"/static/75a4ef063e6184ed5819527bf4104b5b/vm-deploy.png"}}}}]},"file":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/a9e176c8b5d5241ac6440aa4781a5cc7/a0287/profile-image.png","srcSet":"/static/a9e176c8b5d5241ac6440aa4781a5cc7/6ecb6/profile-image.png 30w,\n/static/a9e176c8b5d5241ac6440aa4781a5cc7/43a9d/profile-image.png 60w,\n/static/a9e176c8b5d5241ac6440aa4781a5cc7/a0287/profile-image.png 120w,\n/static/a9e176c8b5d5241ac6440aa4781a5cc7/f5f72/profile-image.png 240w","sizes":"(min-width: 120px) 120px, 100vw"},"sources":[{"srcSet":"/static/a9e176c8b5d5241ac6440aa4781a5cc7/2b147/profile-image.webp 30w,\n/static/a9e176c8b5d5241ac6440aa4781a5cc7/caa3b/profile-image.webp 60w,\n/static/a9e176c8b5d5241ac6440aa4781a5cc7/b15f9/profile-image.webp 120w,\n/static/a9e176c8b5d5241ac6440aa4781a5cc7/b5014/profile-image.webp 240w","type":"image/webp","sizes":"(min-width: 120px) 120px, 100vw"}]},"width":120,"height":120}},"publicURL":"/static/a9e176c8b5d5241ac6440aa4781a5cc7/profile-image.png"}},"pageContext":{"slug":"/development/vm-deploy/","prev":{"fields":{"slug":"/development/redux-toolkit-thunk/"},"frontmatter":{"title":"Redux Toolkit Thunk"}},"next":{"fields":{"slug":"/trouble-shooting/nextjs-styled-components/"},"frontmatter":{"title":"Next.js에서 styled-components 이슈"}}}},"staticQueryHashes":[],"slicesMap":{}}